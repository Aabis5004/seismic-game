<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEISMIC 2077 - Encrypt the Future</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#0a0a12;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:'Courier New',monospace;overflow:hidden}
        #gameContainer{position:relative;width:1280px;height:720px;max-width:100vw;max-height:100vh;background:#000;border:4px solid #D0A0B7;box-shadow:0 0 50px rgba(208,160,183,0.3)}
        #gameCanvas{display:block;width:100%;height:100%;image-rendering:pixelated;image-rendering:crisp-edges}
        #loadingScreen{position:absolute;inset:0;background:linear-gradient(180deg,#1a1a2e 0%,#16213e 50%,#0f0f23 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;transition:opacity 0.5s}
        #loadingScreen.hidden{opacity:0;pointer-events:none}
        .loading-logo{font-size:48px;color:#D0A0B7;text-shadow:0 0 20px #D0A0B7,0 0 40px #D0A0B7;margin-bottom:10px;letter-spacing:8px;animation:flicker 2s infinite}
        @keyframes flicker{0%,100%{opacity:1}92%{opacity:1}93%{opacity:0.8}94%{opacity:1}95%{opacity:0.9}}
        .loading-subtitle{font-size:14px;color:#888;letter-spacing:12px;margin-bottom:40px}
        .loading-bar{width:300px;height:8px;background:#1a1a2e;border:2px solid #D0A0B7}
        .loading-progress{height:100%;background:linear-gradient(90deg,#6A525D,#D0A0B7);width:0%;transition:width 0.2s}
        .loading-text{margin-top:15px;color:#D0A0B7;font-size:12px}
        #menuScreen{position:absolute;inset:0;background:linear-gradient(180deg,#2d1f3d 0%,#1a1a2e 30%,#0f3460 70%,#16213e 100%);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:90}
        #menuScreen.active{display:flex}
        .menu-logo{margin-bottom:20px}
        .menu-logo svg{width:100px;filter:drop-shadow(0 0 30px rgba(208,160,183,0.5))}
        .menu-title{font-size:72px;color:#D0A0B7;text-shadow:0 0 30px #D0A0B7,4px 4px 0 #6A525D;letter-spacing:8px;margin-bottom:5px}
        .menu-year{font-size:36px;color:#00ff88;text-shadow:0 0 20px #00ff88;margin-bottom:30px}
        .menu-tagline{font-size:14px;color:#aaa;margin-bottom:50px;text-align:center;max-width:500px;line-height:1.8}
        .menu-tagline strong{color:#D0A0B7}
        .menu-btn{padding:15px 60px;font-size:18px;font-family:'Courier New',monospace;background:transparent;border:3px solid #D0A0B7;color:#D0A0B7;cursor:pointer;margin:8px;transition:all 0.2s;letter-spacing:4px}
        .menu-btn:hover{background:#D0A0B7;color:#0a0a12;box-shadow:0 0 30px rgba(208,160,183,0.5)}
        .menu-controls{position:absolute;bottom:30px;color:#666;font-size:12px}
        .menu-controls span{display:inline-block;padding:4px 10px;background:#1a1a2e;border:1px solid #333;margin:0 3px;color:#D0A0B7}
        #hud{position:absolute;top:0;left:0;right:0;padding:15px 20px;display:none;justify-content:space-between;align-items:flex-start;pointer-events:none;z-index:50}
        #hud.active{display:flex}
        .hud-left,.hud-right{display:flex;flex-direction:column;gap:8px}
        .hud-item{display:flex;align-items:center;gap:10px;background:rgba(10,10,18,0.8);padding:8px 15px;border:2px solid #333}
        .hud-icon{font-size:20px}
        .hud-bar{width:150px;height:12px;background:#1a1a2e;border:2px solid #333}
        .hud-bar-fill{height:100%;transition:width 0.3s}
        .hud-health .hud-bar-fill{background:linear-gradient(90deg,#ff4466,#ff6688)}
        .hud-energy .hud-bar-fill{background:linear-gradient(90deg,#D0A0B7,#eac4d5)}
        .hud-score{font-size:24px;color:#D0A0B7;text-shadow:2px 2px 0 #6A525D}
        .hud-crypto{display:flex;align-items:center;gap:8px;font-size:18px;color:#00ff88}
        .hud-level{font-size:14px;color:#888}
        #dialogBox{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:90%;max-width:800px;background:rgba(10,10,18,0.95);border:3px solid #D0A0B7;padding:20px;display:none;z-index:60}
        #dialogBox.active{display:block}
        .dialog-speaker{color:#D0A0B7;font-size:16px;margin-bottom:10px;text-transform:uppercase;letter-spacing:2px}
        .dialog-text{color:#fff;font-size:14px;line-height:1.8}
        .dialog-continue{text-align:right;color:#666;font-size:12px;margin-top:10px}
        #infoPopup{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(10,10,18,0.98);border:3px solid #00ff88;padding:30px;max-width:500px;display:none;z-index:70;text-align:center}
        #infoPopup.active{display:block}
        .info-title{color:#00ff88;font-size:24px;margin-bottom:15px}
        .info-text{color:#ccc;font-size:14px;line-height:1.8;margin-bottom:20px;white-space:pre-line}
        .info-btn{padding:10px 30px;background:#00ff88;border:none;color:#0a0a12;font-family:'Courier New',monospace;font-size:14px;cursor:pointer}
        #pauseScreen{position:absolute;inset:0;background:rgba(0,0,0,0.9);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:80}
        #pauseScreen.active{display:flex}
        .pause-title{font-size:48px;color:#D0A0B7;margin-bottom:30px;letter-spacing:8px}
        #gameOverScreen{position:absolute;inset:0;background:rgba(0,0,0,0.95);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:85}
        #gameOverScreen.active{display:flex}
        .gameover-title{font-size:48px;color:#ff4466;margin-bottom:20px}
        .gameover-score{font-size:24px;color:#D0A0B7;margin-bottom:30px}
        #levelComplete{position:absolute;inset:0;background:rgba(0,0,0,0.9);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:85}
        #levelComplete.active{display:flex}
        .complete-title{font-size:36px;color:#00ff88;margin-bottom:20px}
        .complete-stats{color:#aaa;font-size:16px;margin-bottom:30px;text-align:center;line-height:2}
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="1280" height="720"></canvas>
        <div id="loadingScreen">
            <div class="loading-logo">SEISMIC</div>
            <div class="loading-subtitle">2 0 7 7</div>
            <div class="loading-bar"><div class="loading-progress" id="loadingProgress"></div></div>
            <div class="loading-text" id="loadingText">Initializing encryption protocols...</div>
        </div>
        <div id="menuScreen">
            <div class="menu-logo">
                <svg viewBox="0 0 76 109" fill="none">
                    <path d="M36.5836 0L35.3304 19.8966L0 66.8528L36.5836 0Z" fill="url(#a)"/>
                    <path d="M36.5837 0L66.0275 13.1252L62.2681 55.0834L35.3306 19.8965L36.5837 0Z" fill="url(#b)"/>
                    <path d="M66.0275 13.1251L75.5743 71.0417L62.2681 55.0833L66.0275 13.1251Z" fill="url(#c)"/>
                    <path d="M75.5742 71.0421L60.0508 108.255L26.3271 108.181L62.2676 55.0831L75.5742 71.0421Z" fill="url(#d)"/>
                    <path d="M35.3304 19.8964L62.2679 55.0833L26.3272 108.181L0 66.8526L35.3304 19.8964Z" fill="url(#e)"/>
                    <defs>
                        <linearGradient id="a" x1="18" y1="67" x2="-10" y2="8"><stop stop-color="#D0A0B7"/><stop offset="1" stop-color="#6A525D"/></linearGradient>
                        <linearGradient id="b" x1="51" y1="55" x2="27" y2="6"><stop stop-color="#D0A0B7"/><stop offset="1" stop-color="#6A525D"/></linearGradient>
                        <linearGradient id="c" x1="69" y1="71" x2="38" y2="44"><stop stop-color="#D0A0B7"/><stop offset="1" stop-color="#6A525D"/></linearGradient>
                        <linearGradient id="d" x1="44" y1="108" x2="25" y2="58"><stop stop-color="#8D6477"/><stop offset=".6" stop-color="#6A525D"/></linearGradient>
                        <linearGradient id="e" x1="31" y1="108" x2="0" y2="24"><stop stop-color="#D0A0B7"/><stop offset="1" stop-color="#6A525D"/></linearGradient>
                    </defs>
                </svg>
            </div>
            <div class="menu-title">SEISMIC</div>
            <div class="menu-year">2077</div>
            <p class="menu-tagline">
                In a world where privacy is dead and every transaction is tracked,<br>
                you are the last hope. <strong>Encrypt the future. Build on Seismic.</strong><br><br>
                Collect crypto üíé, find encryption keys üîë, defeat surveillance drones,<br>
                and learn how Seismic is revolutionizing blockchain privacy.
            </p>
            <button class="menu-btn" onclick="startGame()">START GAME</button>
            <button class="menu-btn" onclick="showControls()">CONTROLS</button>
            <div class="menu-controls">
                <span>‚Üê ‚Üí</span> Move <span>SPACE</span> Jump <span>E</span> Talk <span>ESC</span> Pause
            </div>
        </div>
        <div id="hud">
            <div class="hud-left">
                <div class="hud-item hud-health"><span class="hud-icon">‚ù§Ô∏è</span><div class="hud-bar"><div class="hud-bar-fill" id="healthBar" style="width:100%"></div></div></div>
                <div class="hud-item hud-energy"><span class="hud-icon">‚ö°</span><div class="hud-bar"><div class="hud-bar-fill" id="energyBar" style="width:100%"></div></div></div>
                <div class="hud-item"><span class="hud-crypto">üíé <span id="cryptoCount">0</span></span></div>
            </div>
            <div class="hud-right">
                <div class="hud-item"><span class="hud-score">Score: <span id="scoreDisplay">0</span></span></div>
                <div class="hud-item"><span class="hud-level" id="levelDisplay">Level 1: Genesis Block</span></div>
            </div>
        </div>
        <div id="dialogBox">
            <div class="dialog-speaker" id="dialogSpeaker">LYRONS</div>
            <div class="dialog-text" id="dialogText">Welcome to the resistance.</div>
            <div class="dialog-continue">Press SPACE to continue</div>
        </div>
        <div id="infoPopup">
            <div class="info-title" id="infoTitle">ENCRYPTION KEY</div>
            <div class="info-text" id="infoText">You collected an encryption key!</div>
            <button class="info-btn" onclick="closeInfo()">GOT IT</button>
        </div>
        <div id="pauseScreen">
            <div class="pause-title">PAUSED</div>
            <button class="menu-btn" onclick="resumeGame()">RESUME</button>
            <button class="menu-btn" onclick="quitToMenu()">QUIT</button>
        </div>
        <div id="gameOverScreen">
            <div class="gameover-title">SYSTEM FAILURE</div>
            <div class="gameover-score">Final Score: <span id="finalScore">0</span></div>
            <button class="menu-btn" onclick="restartGame()">TRY AGAIN</button>
            <button class="menu-btn" onclick="quitToMenu()">MENU</button>
        </div>
        <div id="levelComplete">
            <div class="complete-title">LEVEL COMPLETE</div>
            <div class="complete-stats" id="levelStats">Crypto: 0<br>Score: 0</div>
            <button class="menu-btn" onclick="nextLevel()">NEXT LEVEL</button>
        </div>
    </div>
<script>
const canvas=document.getElementById('gameCanvas'),ctx=canvas.getContext('2d');
const CONFIG={WIDTH:1280,HEIGHT:720,TILE:32,GRAVITY:0.6,FRICTION:0.8,SPEED:5,JUMP:-14};
const Game={running:false,paused:false,level:0,score:0,crypto:0,keys:{},camera:{x:0,y:0}};
const Player={x:100,y:500,w:28,h:44,vx:0,vy:0,ground:false,hp:100,energy:100,face:1,frame:0,anim:0,state:'idle'};

// ==================== LEVELS ====================
// CHANGE LEVELS HERE - Add platforms, collectibles, enemies, NPCs
const LEVELS=[
{
    name:"Genesis Block",
    width:3000,
    start:{x:100,y:500},
    // PLATFORMS: {x, y, w, h, type:'ground' or 'platform'}
    platforms:[
        {x:0,y:650,w:800,h:70,type:'ground'},
        {x:900,y:650,w:500,h:70,type:'ground'},
        {x:1500,y:650,w:800,h:70,type:'ground'},
        {x:2400,y:650,w:600,h:70,type:'ground'},
        {x:300,y:520,w:150,h:24,type:'platform'},
        {x:550,y:420,w:150,h:24,type:'platform'},
        {x:200,y:320,w:150,h:24,type:'platform'},
        {x:750,y:550,w:100,h:24,type:'platform'},
        {x:1000,y:520,w:200,h:24,type:'platform'},
        {x:1250,y:420,w:150,h:24,type:'platform'},
        {x:1500,y:350,w:200,h:24,type:'platform'},
        {x:1800,y:480,w:150,h:24,type:'platform'},
        {x:2000,y:380,w:200,h:24,type:'platform'},
        {x:2300,y:500,w:150,h:24,type:'platform'},
        {x:2550,y:400,w:200,h:24,type:'platform'},
    ],
    // COLLECTIBLES: {x, y, type:'crypto'üíé, 'key'üîë, or 'data'üì¶}
    collectibles:[
        {x:350,y:480,type:'crypto'},
        {x:600,y:380,type:'crypto'},
        {x:250,y:280,type:'key'},
        {x:1050,y:480,type:'crypto'},
        {x:1300,y:380,type:'crypto'},
        {x:1550,y:310,type:'data'},
        {x:1850,y:440,type:'crypto'},
        {x:2050,y:340,type:'crypto'},
        {x:2350,y:460,type:'crypto'},
        {x:2600,y:360,type:'key'},
    ],
    // ENEMIES: {x, y, type:'drone' or 'guard', patrol: distance}
    enemies:[
        {x:500,y:610,type:'drone',patrol:200},
        {x:1200,y:610,type:'drone',patrol:150},
        {x:1700,y:610,type:'guard',patrol:100},
        {x:2200,y:610,type:'drone',patrol:180},
    ],
    // NPCS: {x, y, name, avatar, dialog:[array of lines]}
    npcs:[
        {x:150,y:606,name:'LYRONS',avatar:'üëî',dialog:[
            "Welcome to the Seismic Underground, operative.",
            "The year is 2077. Every transaction is tracked. Privacy is dead.",
            "But we're changing that. Seismic builds encrypted blockchain technology.",
            "Your mission: Collect encryption keys and crypto to power our network.",
            "Avoid the surveillance drones. They report to the Central Bank.",
            "Good luck. The future of privacy depends on you."
        ]},
        {x:1400,y:606,name:'CIPHER',avatar:'ü•∑',dialog:[
            "Psst... you made it past the first sector.",
            "Those glowing keys? They're encryption fragments.",
            "Collect them all to strengthen our privacy network.",
            "The exit portal is ahead. Keep moving!"
        ]},
    ],
    // HAZARDS (spikes): {x, y, w, h}
    hazards:[
        {x:820,y:620,w:60,h:30},
        {x:1420,y:620,w:60,h:30},
    ],
    // EXIT PORTAL position
    exit:{x:2800,y:550},
    // BACKGROUND
    bg:{
        buildings:[
            {x:100,y:200,w:150,h:450},{x:400,y:300,w:100,h:350},{x:600,y:250,w:200,h:400},
            {x:1000,y:150,w:180,h:500},{x:1300,y:280,w:120,h:370},{x:1600,y:200,w:160,h:450},
            {x:1900,y:320,w:140,h:330},{x:2200,y:180,w:200,h:470},{x:2500,y:260,w:130,h:390},
        ],
        signs:[
            {x:300,y:400,text:'SEISMIC'},{x:900,y:350,text:'ENCRYPT'},
            {x:1500,y:300,text:'PRIVATE'},{x:2100,y:380,text:'BUILD'},
        ]
    }
},
{
    name:"Data Stream",
    width:3500,
    start:{x:100,y:500},
    platforms:[
        {x:0,y:650,w:600,h:70,type:'ground'},
        {x:700,y:600,w:150,h:24,type:'platform'},
        {x:950,y:520,w:150,h:24,type:'platform'},
        {x:1200,y:440,w:150,h:24,type:'platform'},
        {x:1400,y:650,w:400,h:70,type:'ground'},
        {x:1900,y:550,w:200,h:24,type:'platform'},
        {x:2200,y:450,w:200,h:24,type:'platform'},
        {x:2500,y:650,w:500,h:70,type:'ground'},
        {x:3100,y:550,w:200,h:24,type:'platform'},
    ],
    collectibles:[
        {x:750,y:560,type:'crypto'},{x:1000,y:480,type:'crypto'},{x:1250,y:400,type:'key'},
        {x:1550,y:610,type:'crypto'},{x:1950,y:510,type:'data'},{x:2250,y:410,type:'crypto'},
        {x:2650,y:610,type:'crypto'},{x:3150,y:510,type:'key'},
    ],
    enemies:[
        {x:400,y:610,type:'drone',patrol:200},{x:1500,y:610,type:'guard',patrol:150},
        {x:2000,y:510,type:'drone',patrol:100},{x:2700,y:610,type:'guard',patrol:200},
    ],
    npcs:[
        {x:200,y:606,name:'NOVA',avatar:'üë©‚Äçüíª',dialog:[
            "Level 2: The Data Stream.",
            "This sector processes encrypted transactions.",
            "Every data packet you collect strengthens our network.",
            "Be careful - surveillance is heavy here."
        ]},
    ],
    hazards:[{x:620,y:620,w:60,h:30},{x:1820,y:620,w:60,h:30}],
    exit:{x:3300,y:500},
    bg:{
        buildings:[
            {x:200,y:180,w:180,h:470},{x:500,y:250,w:140,h:400},{x:800,y:150,w:200,h:500},
            {x:1200,y:280,w:160,h:370},{x:1600,y:200,w:180,h:450},{x:2000,y:300,w:150,h:350},
            {x:2400,y:180,w:200,h:470},{x:2800,y:250,w:160,h:400},
        ],
        signs:[{x:400,y:380,text:'DATA'},{x:1100,y:320,text:'STREAM'},{x:1800,y:360,text:'SECURE'},{x:2600,y:340,text:'CHAIN'}]
    }
},
{
    name:"Core Protocol",
    width:4000,
    start:{x:100,y:500},
    platforms:[
        {x:0,y:650,w:500,h:70,type:'ground'},
        {x:600,y:580,w:120,h:24,type:'platform'},
        {x:800,y:500,w:120,h:24,type:'platform'},
        {x:1000,y:420,w:120,h:24,type:'platform'},
        {x:1200,y:340,w:150,h:24,type:'platform'},
        {x:1450,y:650,w:400,h:70,type:'ground'},
        {x:1950,y:580,w:150,h:24,type:'platform'},
        {x:2200,y:500,w:150,h:24,type:'platform'},
        {x:2450,y:420,w:150,h:24,type:'platform'},
        {x:2700,y:650,w:500,h:70,type:'ground'},
        {x:3300,y:550,w:200,h:24,type:'platform'},
        {x:3600,y:450,w:200,h:24,type:'platform'},
    ],
    collectibles:[
        {x:650,y:540,type:'crypto'},{x:850,y:460,type:'crypto'},{x:1050,y:380,type:'key'},
        {x:1250,y:300,type:'data'},{x:1600,y:610,type:'crypto'},{x:2000,y:540,type:'crypto'},
        {x:2250,y:460,type:'crypto'},{x:2500,y:380,type:'key'},{x:2850,y:610,type:'crypto'},
        {x:3350,y:510,type:'data'},{x:3650,y:410,type:'key'},
    ],
    enemies:[
        {x:300,y:610,type:'guard',patrol:150},{x:700,y:540,type:'drone',patrol:80},
        {x:1550,y:610,type:'drone',patrol:200},{x:2100,y:540,type:'guard',patrol:100},
        {x:2900,y:610,type:'drone',patrol:180},{x:3400,y:510,type:'drone',patrol:100},
    ],
    npcs:[
        {x:150,y:606,name:'LYRONS',avatar:'üëî',dialog:[
            "The Core Protocol - the heart of their surveillance system.",
            "Destroy it, and we free millions from financial tracking.",
            "This is what we've been fighting for. Make it count."
        ]},
        {x:2800,y:606,name:'CIPHER',avatar:'ü•∑',dialog:[
            "The exit is close! You're almost there!",
            "Once you reach the core, Seismic's encryption will spread worldwide.",
            "Privacy will be restored. GO!"
        ]},
    ],
    hazards:[{x:520,y:620,w:60,h:30},{x:1870,y:620,w:60,h:30},{x:3220,y:620,w:60,h:30}],
    exit:{x:3850,y:400},
    bg:{
        buildings:[
            {x:150,y:150,w:200,h:500},{x:450,y:220,w:150,h:430},{x:750,y:180,w:180,h:470},
            {x:1100,y:250,w:160,h:400},{x:1500,y:150,w:200,h:500},{x:1850,y:280,w:140,h:370},
            {x:2200,y:200,w:170,h:450},{x:2550,y:250,w:150,h:400},{x:2900,y:180,w:190,h:470},
            {x:3250,y:220,w:160,h:430},{x:3550,y:200,w:180,h:450},
        ],
        signs:[{x:350,y:350,text:'CORE'},{x:1000,y:320,text:'PROTOCOL'},{x:1700,y:380,text:'SEISMIC'},{x:2500,y:340,text:'FREEDOM'},{x:3300,y:360,text:'ENCRYPT'}]
    }
}
];

let level=null,collectibles=[],enemies=[],npcs=[];

// LOADING
window.onload=()=>{
    const p=document.getElementById('loadingProgress'),t=document.getElementById('loadingText');
    const steps=[{p:20,t:'Loading encryption modules...'},{p:40,t:'Connecting to blockchain...'},{p:60,t:'Initializing privacy layer...'},{p:80,t:'Decrypting level data...'},{p:100,t:'System ready.'}];
    let i=0;
    const int=setInterval(()=>{
        if(i<steps.length){p.style.width=steps[i].p+'%';t.textContent=steps[i].t;i++;}
        else{clearInterval(int);setTimeout(()=>{document.getElementById('loadingScreen').classList.add('hidden');document.getElementById('menuScreen').classList.add('active');},500);}
    },400);
};

// INPUT
document.addEventListener('keydown',e=>{
    Game.keys[e.code]=true;
    if(e.code==='Escape'){if(Game.running&&!Game.paused)pauseGame();else if(Game.paused)resumeGame();}
    if(e.code==='Space'&&document.getElementById('dialogBox').classList.contains('active')){advanceDialog();e.preventDefault();}
});
document.addEventListener('keyup',e=>{Game.keys[e.code]=false;});

// GAME CONTROL
function startGame(){
    document.getElementById('menuScreen').classList.remove('active');
    document.getElementById('hud').classList.add('active');
    Game.running=true;Game.paused=false;Game.score=0;Game.crypto=0;Game.level=0;
    loadLevel(0);gameLoop();
}

function loadLevel(i){
    level=LEVELS[i];if(!level){showWin();return;}
    Player.x=level.start.x;Player.y=level.start.y;Player.vx=0;Player.vy=0;Player.hp=100;Player.energy=100;
    collectibles=level.collectibles.map(c=>({...c,got:false}));
    enemies=level.enemies.map(e=>({...e,sx:e.x,dir:1}));
    npcs=level.npcs.map(n=>({...n,di:0,talking:false}));
    document.getElementById('levelDisplay').textContent=`Level ${i+1}: ${level.name}`;
    updateHUD();
}

function pauseGame(){Game.paused=true;document.getElementById('pauseScreen').classList.add('active');}
function resumeGame(){Game.paused=false;document.getElementById('pauseScreen').classList.remove('active');}
function quitToMenu(){Game.running=false;Game.paused=false;['pauseScreen','gameOverScreen','levelComplete','hud'].forEach(x=>document.getElementById(x).classList.remove('active'));document.getElementById('menuScreen').classList.add('active');}
function restartGame(){document.getElementById('gameOverScreen').classList.remove('active');loadLevel(Game.level);}
function nextLevel(){document.getElementById('levelComplete').classList.remove('active');Game.level++;loadLevel(Game.level);}
function gameOver(){Game.running=false;document.getElementById('finalScore').textContent=Game.score;document.getElementById('gameOverScreen').classList.add('active');}
function levelComplete(){document.getElementById('levelStats').innerHTML=`Crypto: ${Game.crypto}<br>Score: ${Game.score}`;document.getElementById('levelComplete').classList.add('active');}
function showWin(){alert('üéâ CONGRATULATIONS!\n\nYou completed all levels!\nTotal Score: '+Game.score+'\n\nSeismic encryption is now global.\nPrivacy has been restored.\n\nThank you for playing!');quitToMenu();}

// GAME LOOP
function gameLoop(){if(!Game.running)return;if(!Game.paused){update();render();}requestAnimationFrame(gameLoop);}

// UPDATE
function update(){
    // Input
    if(Game.keys['ArrowLeft']||Game.keys['KeyA']){Player.vx=-CONFIG.SPEED;Player.face=-1;Player.state='run';}
    else if(Game.keys['ArrowRight']||Game.keys['KeyD']){Player.vx=CONFIG.SPEED;Player.face=1;Player.state='run';}
    else{Player.vx*=CONFIG.FRICTION;if(Player.ground)Player.state='idle';}
    if((Game.keys['Space']||Game.keys['ArrowUp']||Game.keys['KeyW'])&&Player.ground){Player.vy=CONFIG.JUMP;Player.ground=false;Player.state='jump';}
    
    // Physics
    Player.vy+=CONFIG.GRAVITY;
    Player.x+=Player.vx;Player.y+=Player.vy;
    
    // Platform collision
    Player.ground=false;
    for(const p of level.platforms){
        if(Player.x+Player.w>p.x&&Player.x<p.x+p.w){
            if(Player.vy>0&&Player.y+Player.h>p.y&&Player.y+Player.h<p.y+p.h+Player.vy){Player.y=p.y-Player.h;Player.vy=0;Player.ground=true;}
            else if(Player.vy<0&&Player.y<p.y+p.h&&Player.y>p.y){Player.y=p.y+p.h;Player.vy=0;}
        }
    }
    for(const p of level.platforms){
        if(Player.y+Player.h>p.y+5&&Player.y<p.y+p.h-5){
            if(Player.vx>0&&Player.x+Player.w>p.x&&Player.x<p.x)Player.x=p.x-Player.w;
            else if(Player.vx<0&&Player.x<p.x+p.w&&Player.x+Player.w>p.x+p.w)Player.x=p.x+p.w;
        }
    }
    
    if(!Player.ground)Player.state=Player.vy<0?'jump':'fall';
    Player.anim++;if(Player.anim>8){Player.anim=0;Player.frame=(Player.frame+1)%4;}
    
    // Bounds
    Player.x=Math.max(0,Math.min(level.width-Player.w,Player.x));
    if(Player.y>CONFIG.HEIGHT+100){takeDamage(50);if(Player.hp>0){Player.x=level.start.x;Player.y=level.start.y;Player.vy=0;}}
    
    // Camera
    Game.camera.x=Player.x-CONFIG.WIDTH/2+Player.w/2;
    Game.camera.x=Math.max(0,Math.min(level.width-CONFIG.WIDTH,Game.camera.x));
    
    // Collectibles
    for(const c of collectibles){
        if(!c.got&&col(Player,{x:c.x,y:c.y,w:24,h:24})){
            c.got=true;
            if(c.type==='crypto'){Game.crypto++;Game.score+=100;notify('+100 CRYPTO','#00ff88');}
            else if(c.type==='key'){Game.score+=500;showInfo('üîë ENCRYPTION KEY','Encryption keys secure transactions on the Seismic blockchain.\n\nWithout encryption, all your financial data would be exposed to surveillance.\n\nSeismic uses advanced cryptography to ensure your transactions remain private.');}
            else if(c.type==='data'){Game.score+=300;showInfo('üì¶ DATA PACKET','Data packets contain encrypted transaction information.\n\nSeismic processes millions of these packets to enable fast, private transfers.\n\nUnlike traditional finance, no one can see what you\'re sending or receiving.');}
            updateHUD();
        }
    }
    
    // Enemies
    for(const e of enemies){
        e.x+=e.dir*2;if(e.x>e.sx+e.patrol||e.x<e.sx-e.patrol)e.dir*=-1;
        if(col(Player,{x:e.x,y:e.y,w:32,h:32})){
            if(Player.vy>0&&Player.y+Player.h<e.y+20){e.x=-1000;Player.vy=CONFIG.JUMP*0.7;Game.score+=200;notify('+200 ENEMY DESTROYED','#ff4466');}
            else takeDamage(25);
        }
    }
    
    // Hazards
    for(const h of level.hazards){if(col(Player,{x:h.x,y:h.y,w:h.w,h:h.h})){takeDamage(50);Player.vy=CONFIG.JUMP;}}
    
    // NPC interaction
    if(Game.keys['KeyE']){for(const n of npcs){if(Math.abs(Player.x-n.x)<60&&!n.talking)startDialog(n);}Game.keys['KeyE']=false;}
    
    // Exit
    if(Player.x>level.exit.x-30&&Player.x<level.exit.x+30&&Player.y>level.exit.y-50)levelComplete();
    
    // Energy regen
    Player.energy=Math.min(100,Player.energy+0.1);
    document.getElementById('energyBar').style.width=Player.energy+'%';
}

function col(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}
function takeDamage(n){Player.hp-=n;document.getElementById('healthBar').style.width=Math.max(0,Player.hp)+'%';if(Player.hp<=0)gameOver();}
function updateHUD(){document.getElementById('cryptoCount').textContent=Game.crypto;document.getElementById('scoreDisplay').textContent=Game.score;}

// RENDER
function render(){
    // Sky
    const g=ctx.createLinearGradient(0,0,0,CONFIG.HEIGHT);
    g.addColorStop(0,'#2d1f3d');g.addColorStop(0.3,'#1a1a2e');g.addColorStop(0.7,'#0f3460');g.addColorStop(1,'#16213e');
    ctx.fillStyle=g;ctx.fillRect(0,0,CONFIG.WIDTH,CONFIG.HEIGHT);
    
    // Stars
    ctx.fillStyle='#fff';
    for(let i=0;i<50;i++){const x=(i*73)%CONFIG.WIDTH,y=(i*37)%(CONFIG.HEIGHT/2),s=(i%3)+1;ctx.globalAlpha=0.3+(i%5)*0.1;ctx.fillRect(x,y,s,s);}
    ctx.globalAlpha=1;
    
    // Background buildings
    const px=Game.camera.x*0.3;
    for(const b of level.bg.buildings){
        const bx=b.x-px;if(bx>-b.w&&bx<CONFIG.WIDTH+b.w){
            ctx.fillStyle='#0a0a15';ctx.fillRect(bx,b.y,b.w,b.h);
            ctx.fillStyle='#151525';ctx.fillRect(bx+4,b.y,b.w-8,b.h);
            ctx.fillStyle=Math.random()>0.7?'#D0A0B7':'#252540';
            for(let wy=b.y+20;wy<b.y+b.h-30;wy+=30)for(let wx=bx+15;wx<bx+b.w-20;wx+=25)ctx.fillRect(wx,wy,12,18);
        }
    }
    
    // Signs
    ctx.font='bold 24px Courier New';ctx.fillStyle='#D0A0B7';ctx.globalAlpha=0.6;
    for(const s of level.bg.signs){const sx=s.x-px;if(sx>-100&&sx<CONFIG.WIDTH+100)ctx.fillText(s.text,sx,s.y);}
    ctx.globalAlpha=1;
    
    // Platforms
    for(const p of level.platforms){
        const x=p.x-Game.camera.x;if(x>-p.w&&x<CONFIG.WIDTH){
            if(p.type==='ground'){ctx.fillStyle='#2d2d44';ctx.fillRect(x,p.y,p.w,p.h);ctx.fillStyle='#3d3d5c';ctx.fillRect(x,p.y,p.w,8);}
            else{ctx.fillStyle='#3d3d5c';ctx.fillRect(x,p.y,p.w,p.h);ctx.fillStyle='#4d4d6c';ctx.fillRect(x+4,p.y+4,p.w-8,p.h-8);}
        }
    }
    
    // Hazards
    for(const h of level.hazards){
        const hx=h.x-Game.camera.x;ctx.fillStyle='#ff4466';
        for(let i=0;i<h.w;i+=15){ctx.beginPath();ctx.moveTo(hx+i,h.y+h.h);ctx.lineTo(hx+i+7,h.y);ctx.lineTo(hx+i+14,h.y+h.h);ctx.fill();}
    }
    
    // Collectibles
    for(const c of collectibles){
        if(c.got)continue;
        const cx=c.x-Game.camera.x,cy=c.y+Math.sin(Date.now()/200)*5;
        ctx.globalAlpha=0.3;ctx.beginPath();ctx.arc(cx+12,cy+12,20,0,Math.PI*2);
        ctx.fillStyle=c.type==='crypto'?'#00ff88':c.type==='key'?'#D0A0B7':'#00aaff';ctx.fill();ctx.globalAlpha=1;
        ctx.font='24px Arial';ctx.fillText(c.type==='crypto'?'üíé':c.type==='key'?'üîë':'üì¶',cx,cy+20);
    }
    
    // Enemies
    for(const e of enemies){
        const ex=e.x-Game.camera.x;if(ex>-50&&ex<CONFIG.WIDTH+50&&e.x>0){
            ctx.fillStyle=e.type==='drone'?'#ff4466':'#ff8844';ctx.fillRect(ex,e.y,32,32);
            ctx.fillStyle='#fff';ctx.fillRect(ex+(e.dir>0?20:8),e.y+10,8,8);
            ctx.fillStyle='#000';ctx.fillRect(ex+(e.dir>0?24:10),e.y+12,4,4);
        }
    }
    
    // NPCs
    for(const n of npcs){
        const nx=n.x-Game.camera.x;
        ctx.fillStyle='#1a3a5a';ctx.fillRect(nx-5,n.y-44,42,50);
        ctx.strokeStyle='#00aaff';ctx.lineWidth=2;ctx.strokeRect(nx-5,n.y-44,42,50);
        ctx.font='28px Arial';ctx.fillText(n.avatar,nx,n.y-10);
        ctx.font='10px Courier New';ctx.fillStyle='#00aaff';ctx.fillText(n.name,nx-5,n.y-50);
        if(Math.abs(Player.x-n.x)<60){ctx.fillStyle='#00ff88';ctx.font='12px Courier New';ctx.fillText('[E] Talk',nx-10,n.y-65);}
    }
    
    // Exit
    const ex=level.exit.x-Game.camera.x,ey=level.exit.y;
    ctx.fillStyle='#00ff88';ctx.globalAlpha=0.5+Math.sin(Date.now()/200)*0.3;ctx.fillRect(ex-20,ey-60,40,70);
    ctx.globalAlpha=1;ctx.font='12px Courier New';ctx.fillStyle='#00ff88';ctx.fillText('EXIT',ex-15,ey-70);
    
    // Player
    const plx=Player.x-Game.camera.x,ply=Player.y;
    ctx.fillStyle='rgba(0,0,0,0.3)';ctx.beginPath();ctx.ellipse(plx+Player.w/2,ply+Player.h+5,15,5,0,0,Math.PI*2);ctx.fill();
    ctx.save();ctx.translate(plx+Player.w/2,ply+Player.h/2);if(Player.face<0)ctx.scale(-1,1);ctx.translate(-Player.w/2,-Player.h/2);
    ctx.fillStyle='#D0A0B7';ctx.fillRect(6,8,16,24);
    ctx.fillStyle='#eac4d5';ctx.fillRect(6,0,16,14);
    ctx.fillStyle='#000';ctx.fillRect(16,4,4,4);
    ctx.fillStyle='#6A525D';
    if(Player.state==='run'){const lo=Math.sin(Player.frame*Math.PI/2)*6;ctx.fillRect(6,32,6,12+lo);ctx.fillRect(16,32,6,12-lo);}
    else{ctx.fillRect(6,32,6,12);ctx.fillRect(16,32,6,12);}
    ctx.restore();
}

// DIALOG
let curNPC=null;
function startDialog(n){curNPC=n;n.di=0;n.talking=true;showLine();document.getElementById('dialogBox').classList.add('active');Game.paused=true;}
function showLine(){if(!curNPC)return;const d=curNPC.dialog[curNPC.di];if(!d){closeDialog();return;}document.getElementById('dialogSpeaker').textContent=curNPC.name;document.getElementById('dialogText').textContent=d;}
function advanceDialog(){if(!curNPC)return;curNPC.di++;if(curNPC.di>=curNPC.dialog.length)closeDialog();else showLine();}
function closeDialog(){document.getElementById('dialogBox').classList.remove('active');if(curNPC)curNPC.talking=false;curNPC=null;Game.paused=false;}

// INFO
function showInfo(t,txt){document.getElementById('infoTitle').textContent=t;document.getElementById('infoText').textContent=txt;document.getElementById('infoPopup').classList.add('active');Game.paused=true;}
function closeInfo(){document.getElementById('infoPopup').classList.remove('active');Game.paused=false;}

// NOTIFY
function notify(t,c){const n=document.createElement('div');n.style.cssText=`position:absolute;top:150px;left:50%;transform:translateX(-50%);background:rgba(10,10,18,0.9);border:2px solid ${c};color:${c};padding:10px 20px;font-family:'Courier New',monospace;font-size:16px;z-index:100;animation:fadeUp 1s forwards;`;n.textContent=t;document.getElementById('gameContainer').appendChild(n);setTimeout(()=>n.remove(),1000);}
const st=document.createElement('style');st.textContent='@keyframes fadeUp{0%{opacity:1;transform:translateX(-50%) translateY(0)}100%{opacity:0;transform:translateX(-50%) translateY(-30px)}}';document.head.appendChild(st);

// MENU
function showControls(){alert('üéÆ CONTROLS\n\n‚Üê ‚Üí or A D : Move left/right\nSPACE or W or ‚Üë : Jump\nE : Talk to NPCs\nESC : Pause game\n\nüíé Crypto = +100 points\nüîë Keys = +500 points + info\nüì¶ Data = +300 points + info\n\nJump on enemies to destroy them!\nAvoid spikes!');}
</script>
</body>
</html>
