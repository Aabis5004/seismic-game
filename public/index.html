<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SEISMIC 2026</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0d0d15;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:Arial}
#g{border:2px solid #D0A0B7;box-shadow:0 0 30px rgba(208,160,183,0.2)}
.m{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:999;justify-content:center;align-items:center}
.m.show{display:flex}
.mb{background:#1a1a2e;border:2px solid #D0A0B7;border-radius:10px;padding:30px;width:320px}
.mb h2{color:#D0A0B7;text-align:center;margin-bottom:20px}
.mb input{width:100%;padding:12px;margin:6px 0;background:#0d0d15;border:1px solid #333;color:#fff;border-radius:5px}
.mb input:focus{border-color:#D0A0B7;outline:none}
.mb button{width:100%;padding:12px;margin-top:12px;background:#D0A0B7;border:none;color:#0d0d15;font-weight:bold;border-radius:5px;cursor:pointer}
.mb .err{color:#ff4466;font-size:11px;text-align:center;margin-top:8px}
.mb .sw{color:#666;font-size:11px;text-align:center;margin-top:12px}
.mb .sw a{color:#D0A0B7;cursor:pointer}
</style>
</head>
<body>
<div id="g"></div>
<div class="m" id="logM"><div class="mb"><h2>LOGIN</h2><input id="lu" placeholder="Username"><input type="password" id="lp" placeholder="Password"><button onclick="login()">LOGIN</button><div class="err" id="le"></div><div class="sw">No account? <a onclick="showM('regM')">Register</a></div></div></div>
<div class="m" id="regM"><div class="mb"><h2>REGISTER</h2><input id="rn" placeholder="Your Name"><input id="ru" placeholder="Username"><input type="password" id="rp" placeholder="Password"><button onclick="register()">CREATE</button><div class="err" id="re"></div><div class="sw">Have account? <a onclick="showM('logM')">Login</a></div></div></div>
<script>
var U=null,T=null;
try{U=JSON.parse(localStorage.getItem('su'));T=localStorage.getItem('st')}catch(e){}
function showM(id){document.querySelectorAll('.m').forEach(function(m){m.classList.remove('show')});if(id)document.getElementById(id).classList.add('show')}
function login(){
    var u=document.getElementById('lu').value,p=document.getElementById('lp').value;
    if(!u||!p){document.getElementById('le').textContent='Fill all fields';return}
    fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})})
    .then(function(r){return r.json()}).then(function(d){
        if(d.error){document.getElementById('le').textContent=d.error;return}
        U=d.user;T=d.token;localStorage.setItem('su',JSON.stringify(U));localStorage.setItem('st',T);showM();location.reload()
    }).catch(function(){document.getElementById('le').textContent='Error'})
}
function register(){
    var n=document.getElementById('rn').value,u=document.getElementById('ru').value,p=document.getElementById('rp').value;
    if(!n||!u||!p){document.getElementById('re').textContent='Fill all fields';return}
    fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({realName:n,username:u,password:p})})
    .then(function(r){return r.json()}).then(function(d){
        if(d.error){document.getElementById('re').textContent=d.error;return}
        U=d.user;T=d.token;localStorage.setItem('su',JSON.stringify(U));localStorage.setItem('st',T);showM();location.reload()
    }).catch(function(){document.getElementById('re').textContent='Error'})
}
function logout(){U=null;T=null;localStorage.removeItem('su');localStorage.removeItem('st');location.reload()}

var W=1280,H=720,PK=0xD0A0B7,GR=0x00ff88,RD=0xff4466;
var Audio={ctx:null,on:false,
init:function(){if(!this.ctx)this.ctx=new(window.AudioContext||window.webkitAudioContext)()},
play:function(){if(this.on)return;this.init();this.on=true;this.loop()},
stop:function(){this.on=false},
loop:function(){if(!this.on)return;var self=this,n=this.ctx.currentTime,notes=[130,165,196,220,196,165];
for(var i=0;i<notes.length;i++){var o=this.ctx.createOscillator(),g=this.ctx.createGain();o.connect(g);g.connect(this.ctx.destination);o.type='sine';o.frequency.value=notes[i];g.gain.value=0.06;g.gain.exponentialRampToValueAtTime(0.001,n+i*0.2+0.19);o.start(n+i*0.2);o.stop(n+i*0.2+0.2)}
setTimeout(function(){self.loop()},1200)},
fx:function(f){this.init();var o=this.ctx.createOscillator(),g=this.ctx.createGain();o.connect(g);g.connect(this.ctx.destination);o.type='square';o.frequency.value=f;g.gain.value=0.08;g.gain.exponentialRampToValueAtTime(0.001,this.ctx.currentTime+0.1);o.start();o.stop(this.ctx.currentTime+0.1)}};

// SEISMIC LOGO - Stacked bars forming abstract S shape
function drawSeismicLogo(scene,x,y,scale){
    var s=scale||1;
    var g=scene.add.graphics();
    
    // The Seismic logo is stacked horizontal bars
    // Top section - 3 bars going right
    g.fillStyle(0xD0A0B7,1);
    g.fillRoundedRect(x-30*s,y-45*s,50*s,8*s,2);
    g.fillRoundedRect(x-30*s,y-33*s,42*s,8*s,2);
    g.fillRoundedRect(x-30*s,y-21*s,34*s,8*s,2);
    
    // Middle bar
    g.fillRoundedRect(x-15*s,y-9*s,30*s,8*s,2);
    
    // Bottom section - 3 bars going left
    g.fillRoundedRect(x-4*s,y+3*s,34*s,8*s,2);
    g.fillRoundedRect(x-12*s,y+15*s,42*s,8*s,2);
    g.fillRoundedRect(x-20*s,y+27*s,50*s,8*s,2);
    
    return g;
}

var BootScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Boot'})},
preload:function(){
    var self=this;
    this.add.rectangle(W/2,H/2,W,H,0x0d0d15);
    drawSeismicLogo(this,W/2,H/2-60,1.5);
    this.add.text(W/2,H/2+30,'SEISMIC',{fontSize:'48px',fontStyle:'bold',color:'#D0A0B7'}).setOrigin(0.5);
    this.add.text(W/2,H/2+75,'2026',{fontSize:'24px',color:'#00ff88'}).setOrigin(0.5);
    var fill=this.add.rectangle(W/2-120,H/2+120,0,12,PK).setOrigin(0,0.5);
    this.add.rectangle(W/2,H/2+120,250,14,0x1a1a2e).setStrokeStyle(1,PK);
    var p=0;this.time.addEvent({delay:250,repeat:4,callback:function(){p+=25;fill.width=240*(p/100);if(p>=100)self.time.delayedCall(300,function(){self.scene.start('Menu')})}});
    this.genTex();
},
genTex:function(){
    var g=this.make.graphics({add:false});
    g.fillStyle(0x1a1a2e);g.fillRoundedRect(6,10,20,30,3);g.fillStyle(PK);g.fillRoundedRect(8,12,16,12,2);g.fillStyle(0x2a2a3e);g.fillRoundedRect(9,0,14,12,3);g.fillStyle(GR);g.fillRect(11,4,10,4);g.fillStyle(0x1a1a2e);g.fillRect(9,40,6,12);g.fillRect(17,40,6,12);g.fillStyle(0x333333);g.fillRect(5,16,5,18);g.fillRect(22,16,5,18);g.generateTexture('p',32,54);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x1a1a2e);g.fillRoundedRect(6,8,20,30,3);g.fillStyle(PK);g.fillRoundedRect(8,10,16,12,2);g.fillStyle(0x2a2a3e);g.fillRoundedRect(9,0,14,10,3);g.fillStyle(GR);g.fillRect(11,3,10,4);g.fillStyle(0x1a1a2e);g.fillRoundedRect(10,38,12,12,2);g.fillStyle(0x333333);g.fillRect(5,14,5,18);g.fillRect(22,14,5,18);g.fillStyle(0xffaa00);g.fillTriangle(7,32,5,46,9,46);g.fillTriangle(25,32,23,46,27,46);g.generateTexture('pf',32,50);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x222222);g.fillEllipse(14,10,24,14);g.fillStyle(RD);g.fillCircle(14,10,5);g.generateTexture('dr',28,22);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x2a1a1a);g.fillRoundedRect(4,12,20,24,3);g.fillStyle(0x2a1a1a);g.fillRoundedRect(6,0,16,14,3);g.fillStyle(RD);g.fillRect(8,4,12,5);g.fillStyle(0x2a1a1a);g.fillRect(6,36,7,12);g.fillRect(15,36,7,12);g.generateTexture('gu',28,50);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(GR);g.fillRoundedRect(0,1,12,4,2);g.generateTexture('b',12,6);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(RD);g.fillCircle(4,4,4);g.generateTexture('eb',8,8);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x252535);g.fillRoundedRect(0,0,100,20,4);g.fillStyle(PK,0.3);g.fillCircle(15,10,2);g.fillCircle(50,10,2);g.fillCircle(85,10,2);g.generateTexture('pl',100,20);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x151520);g.fillRect(0,0,64,64);g.fillStyle(0x1a1a28);g.fillRect(0,0,64,6);g.generateTexture('gr',64,64);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(GR,0.2);g.fillCircle(12,12,11);g.fillStyle(GR);g.fillCircle(12,12,8);g.fillStyle(0xffffff);g.fillRect(10,7,4,10);g.fillRect(7,10,10,4);g.generateTexture('cr',24,24);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(RD,0.2);g.fillCircle(12,12,11);g.fillStyle(0xffffff);g.fillRoundedRect(5,5,14,14,2);g.fillStyle(RD);g.fillRect(10,7,4,10);g.fillRect(7,10,10,4);g.generateTexture('hp',24,24);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0xffaa00,0.2);g.fillCircle(12,12,11);g.fillStyle(0xffaa00);g.fillTriangle(14,4,8,14,12,14);g.fillTriangle(10,10,16,20,12,10);g.generateTexture('en',24,24);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(GR,0.3);g.fillEllipse(20,35,35,60);g.fillStyle(GR,0.6);g.fillEllipse(20,35,22,40);g.fillStyle(GR);g.fillEllipse(20,35,12,22);g.generateTexture('po',40,70);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(RD);g.fillTriangle(8,0,1,18,15,18);g.fillTriangle(24,0,17,18,31,18);g.fillTriangle(40,0,33,18,47,18);g.generateTexture('sp',48,18);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(0x1a1a2e);g.fillRoundedRect(0,0,200,44,6);g.lineStyle(2,PK);g.strokeRoundedRect(0,0,200,44,6);g.generateTexture('bt',200,44);g.destroy();
    g=this.make.graphics({add:false});g.fillStyle(PK);g.fillRoundedRect(0,0,200,44,6);g.generateTexture('bt2',200,44);g.destroy();
}});

var MenuScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Menu'})},
create:function(){
    var self=this;
    this.add.rectangle(W/2,H/2,W,H,0x0d0d15);
    for(var i=0;i<20;i++){var s=this.add.circle(Phaser.Math.Between(0,W),Phaser.Math.Between(0,H),1,0xffffff,0.15);this.tweens.add({targets:s,y:'-=80',alpha:0,duration:Phaser.Math.Between(3000,5000),repeat:-1})}
    drawSeismicLogo(this,W/2,110,1.2);
    this.add.text(W/2,175,'SEISMIC',{fontSize:'38px',fontStyle:'bold',color:'#D0A0B7'}).setOrigin(0.5);
    this.add.text(W/2,215,'2026',{fontSize:'20px',color:'#00ff88'}).setOrigin(0.5);
    if(U){
        this.add.text(W/2,265,'Welcome, '+U.realName,{fontSize:'15px',color:'#D0A0B7'}).setOrigin(0.5);
        this.btn(W/2,330,'START GAME',function(){Audio.play();self.scene.start('Levels')});
        this.btn(W/2,390,'LEADERBOARD',function(){self.scene.start('Leader')});
        this.btn(W/2,450,'LOGOUT',logout);
    }else{
        this.add.text(W/2,265,'Encrypt the future of finance',{fontSize:'12px',color:'#666'}).setOrigin(0.5);
        this.btn(W/2,330,'LOGIN',function(){showM('logM')});
        this.btn(W/2,390,'REGISTER',function(){showM('regM')});
        this.btn(W/2,450,'PLAY AS GUEST',function(){U={username:'Guest',realName:'Guest'};Audio.play();self.scene.start('Levels')});
    }
    this.add.text(W/2,H-30,'WASD Move | SPACE Fly | CLICK Shoot',{fontSize:'10px',color:'#444'}).setOrigin(0.5);
},
btn:function(x,y,t,f){var b=this.add.image(x,y,'bt').setInteractive({useHandCursor:true}),tx=this.add.text(x,y,t,{fontSize:'14px',color:'#D0A0B7'}).setOrigin(0.5);b.on('pointerover',function(){b.setTexture('bt2');tx.setColor('#0d0d15')});b.on('pointerout',function(){b.setTexture('bt');tx.setColor('#D0A0B7')});b.on('pointerdown',f)}
});

var LevelsScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Levels'})},
create:function(){
    var self=this;this.add.rectangle(W/2,H/2,W,H,0x0d0d15);
    this.add.text(W/2,45,'SELECT LEVEL',{fontSize:'26px',color:'#D0A0B7'}).setOrigin(0.5);
    var lvls=['GENESIS BLOCK','DATA BREACH','ENCRYPTED RAILS','FIREWALL','LIBERATION'];
    for(var i=0;i<lvls.length;i++){(function(idx,nm){
        var y=120+idx*90,b=self.add.rectangle(W/2,y,550,70,0x1a1a2e).setStrokeStyle(1,PK).setInteractive({useHandCursor:true});
        self.add.text(W/2-250,y-12,'LEVEL '+(idx+1),{fontSize:'11px',color:'#00ff88'});
        self.add.text(W/2-250,y+10,nm,{fontSize:'15px',color:'#D0A0B7'});
        b.on('pointerover',function(){b.setFillStyle(0x252535)});b.on('pointerout',function(){b.setFillStyle(0x1a1a2e)});b.on('pointerdown',function(){self.scene.start('Game',{lv:idx+1})});
    })(i,lvls[i])}
    this.btn(W/2,H-45,'BACK',function(){self.scene.start('Menu')});
},btn:function(x,y,t,f){var b=this.add.image(x,y,'bt').setInteractive({useHandCursor:true}),tx=this.add.text(x,y,t,{fontSize:'14px',color:'#D0A0B7'}).setOrigin(0.5);b.on('pointerover',function(){b.setTexture('bt2');tx.setColor('#0d0d15')});b.on('pointerout',function(){b.setTexture('bt');tx.setColor('#D0A0B7')});b.on('pointerdown',f)}
});

var LeaderScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Leader'})},
create:function(){
    var self=this;this.add.rectangle(W/2,H/2,W,H,0x0d0d15);
    this.add.text(W/2,45,'LEADERBOARD',{fontSize:'26px',color:'#D0A0B7'}).setOrigin(0.5);
    fetch('/api/game/leaderboard').then(function(r){return r.json()}).then(function(d){
        if(d.leaderboard&&d.leaderboard.length>0){for(var i=0;i<Math.min(10,d.leaderboard.length);i++){var e=d.leaderboard[i],y=100+i*45,c=i===0?'#ffd700':i===1?'#c0c0c0':i===2?'#cd7f32':'#666';self.add.text(W/2-200,y,'#'+(i+1),{fontSize:'15px',color:c});self.add.text(W/2-160,y,e.realName||e.username,{fontSize:'14px',color:'#D0A0B7'});self.add.text(W/2+160,y,String(e.highScore||0),{fontSize:'14px',color:'#00ff88'}).setOrigin(1,0)}}
        else self.add.text(W/2,280,'No scores yet',{fontSize:'13px',color:'#666'}).setOrigin(0.5);
    }).catch(function(){self.add.text(W/2,280,'Play to get ranked!',{fontSize:'13px',color:'#666'}).setOrigin(0.5)});
    this.btn(W/2,H-45,'BACK',function(){self.scene.start('Menu')});
},btn:function(x,y,t,f){var b=this.add.image(x,y,'bt').setInteractive({useHandCursor:true}),tx=this.add.text(x,y,t,{fontSize:'14px',color:'#D0A0B7'}).setOrigin(0.5);b.on('pointerover',function(){b.setTexture('bt2');tx.setColor('#0d0d15')});b.on('pointerout',function(){b.setTexture('bt');tx.setColor('#D0A0B7')});b.on('pointerdown',f)}
});

var GameScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Game'})},
init:function(d){this.lv=d.lv||1;this.sc=0;this.cry=0;this.hp=100;this.en=100;this.dead=false;this.won=false},
create:function(){
    var self=this,L=this.getLevel();
    this.physics.world.setBounds(0,0,L.w,H);this.cameras.main.setBounds(0,0,L.w,H);
    var bg=this.add.graphics();bg.fillGradientStyle(0x1a1525,0x1a1525,0x0d1525,0x0d1525);bg.fillRect(0,0,L.w,H);
    for(var i=0;i<40;i++)this.add.circle(Phaser.Math.Between(0,L.w),Phaser.Math.Between(0,H/2),1,0xffffff,0.1).setScrollFactor(0.1);
    for(var i=0;i<12;i++)this.add.rectangle(i*(L.w/12),H-Phaser.Math.Between(50,125),Phaser.Math.Between(40,80),Phaser.Math.Between(100,250),0x0a0a12).setScrollFactor(0.2);
    this.plats=this.physics.add.staticGroup();
    for(var i=0;i<L.pl.length;i++){var p=L.pl[i];if(p.g){for(var x=p.x;x<p.x+p.w;x+=64)this.plats.create(x+32,p.y+20,'gr')}else this.plats.create(p.x,p.y,'pl')}
    this.haz=this.physics.add.staticGroup();for(var i=0;i<L.hz.length;i++)this.haz.create(L.hz[i].x,L.hz[i].y,'sp');
    this.por=this.physics.add.staticImage(L.ex.x,L.ex.y,'po');this.tweens.add({targets:this.por,alpha:0.5,scaleX:1.05,duration:700,yoyo:true,repeat:-1});
    this.player=this.physics.add.sprite(80,500,'p').setCollideWorldBounds(true);this.player.body.setSize(18,48).setOffset(7,4);
    this.enemies=this.physics.add.group();
    for(var i=0;i<L.en.length;i++){var e=L.en[i],en=this.enemies.create(e.x,e.y,e.t==='d'?'dr':'gu');en.tp=e.t;en.sx=e.x;en.dir=1;en.hp=e.t==='d'?25:50;en.st=0;if(e.t==='d')en.body.allowGravity=false}
    this.items=this.physics.add.group();
    for(var i=0;i<L.it.length;i++){var itm=L.it[i],it=this.items.create(itm.x,itm.y,itm.t);it.body.allowGravity=false;it.tp=itm.t;this.tweens.add({targets:it,y:itm.y-8,duration:1200,yoyo:true,repeat:-1,ease:'Sine.easeInOut'})}
    this.bullets=this.physics.add.group();this.ebullets=this.physics.add.group();this.lastShot=0;
    this.physics.add.collider(this.player,this.plats);this.physics.add.collider(this.enemies,this.plats);
    this.physics.add.overlap(this.player,this.items,this.collect,null,this);
    this.physics.add.overlap(this.bullets,this.enemies,this.hitEnemy,null,this);
    this.physics.add.overlap(this.player,this.enemies,this.playerHit,null,this);
    this.physics.add.overlap(this.player,this.haz,this.playerHitHaz,null,this);
    this.physics.add.overlap(this.player,this.ebullets,this.playerHitBullet,null,this);
    this.physics.add.overlap(this.player,this.por,this.win,null,this);
    this.keys=this.input.keyboard.addKeys({w:'W',a:'A',s:'S',d:'D',sp:'SPACE'});
    this.input.on('pointerdown',function(pt){self.shoot(pt)});
    this.cameras.main.startFollow(this.player,true,0.08,0.08);
    this.hpBar=this.add.graphics().setScrollFactor(0).setDepth(99);this.enBar=this.add.graphics().setScrollFactor(0).setDepth(99);
    this.add.rectangle(105,20,170,16,0x0d0d15,0.8).setScrollFactor(0).setDepth(98);
    this.add.rectangle(105,42,170,16,0x0d0d15,0.8).setScrollFactor(0).setDepth(98);
    this.add.text(18,14,'HP',{fontSize:'10px',color:'#ff4466'}).setScrollFactor(0).setDepth(99);
    this.add.text(18,36,'BOOST',{fontSize:'10px',color:'#D0A0B7'}).setScrollFactor(0).setDepth(99);
    this.scTxt=this.add.text(W-15,12,'0',{fontSize:'16px',color:'#D0A0B7'}).setOrigin(1,0).setScrollFactor(0).setDepth(99);
    this.crTxt=this.add.text(W-15,32,'0',{fontSize:'11px',color:'#00ff88'}).setOrigin(1,0).setScrollFactor(0).setDepth(99);
    this.input.keyboard.on('keydown-ESC',function(){self.scene.pause();self.scene.launch('Pause',{lv:self.lv})});
    var ov=this.add.rectangle(W/2,H/2,W,H,0x000000,0.85).setScrollFactor(0).setDepth(200);
    var t1=this.add.text(W/2,H/2-20,'LEVEL '+this.lv,{fontSize:'32px',color:'#D0A0B7'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);
    var t2=this.add.text(W/2,H/2+20,L.nm,{fontSize:'16px',color:'#00ff88'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);
    this.time.delayedCall(1500,function(){self.tweens.add({targets:[ov,t1,t2],alpha:0,duration:400,onComplete:function(){ov.destroy();t1.destroy();t2.destroy()}})});
    this.updateHUD();
},
getLevel:function(){
    var L={
        1:{nm:'GENESIS BLOCK',w:3500,pl:[{x:0,y:680,w:700,g:1},{x:800,y:680,w:500,g:1},{x:1400,y:680,w:700,g:1},{x:2200,y:680,w:500,g:1},{x:2800,y:680,w:700,g:1},{x:280,y:550},{x:500,y:450},{x:900,y:530},{x:1150,y:430},{x:1450,y:500},{x:1700,y:400},{x:2000,y:530},{x:2300,y:430},{x:2600,y:500},{x:2900,y:400},{x:3150,y:500}],en:[{x:550,y:640,t:'d'},{x:1000,y:640,t:'d'},{x:1550,y:640,t:'g'},{x:2100,y:400,t:'d'},{x:2650,y:640,t:'g'},{x:3050,y:460,t:'d'}],it:[{x:320,y:510,t:'cr'},{x:540,y:410,t:'cr'},{x:940,y:490,t:'cr'},{x:1200,y:390,t:'cr'},{x:1500,y:460,t:'hp'},{x:1750,y:360,t:'cr'},{x:2050,y:490,t:'cr'},{x:2350,y:390,t:'en'},{x:2650,y:460,t:'cr'},{x:2950,y:360,t:'cr'}],hz:[{x:750,y:662},{x:1350,y:662},{x:2150,y:662},{x:2750,y:662}],ex:{x:3400,y:620}},
        2:{nm:'DATA BREACH',w:4000,pl:[{x:0,y:680,w:600,g:1},{x:700,y:680,w:500,g:1},{x:1300,y:680,w:600,g:1},{x:2000,y:680,w:500,g:1},{x:2600,y:680,w:600,g:1},{x:3300,y:680,w:700,g:1},{x:350,y:520},{x:600,y:420},{x:900,y:520},{x:1500,y:500},{x:1800,y:400},{x:2200,y:520},{x:2500,y:420},{x:2850,y:520},{x:3200,y:420},{x:3550,y:520}],en:[{x:500,y:640,t:'d'},{x:950,y:480,t:'d'},{x:1600,y:640,t:'g'},{x:1900,y:360,t:'d'},{x:2700,y:640,t:'g'},{x:3100,y:380,t:'d'},{x:3600,y:640,t:'g'}],it:[{x:400,y:480,t:'cr'},{x:650,y:380,t:'cr'},{x:950,y:480,t:'hp'},{x:1550,y:460,t:'cr'},{x:1850,y:360,t:'cr'},{x:2250,y:480,t:'cr'},{x:2550,y:380,t:'en'},{x:2900,y:480,t:'cr'},{x:3250,y:380,t:'hp'},{x:3600,y:480,t:'cr'}],hz:[{x:650,y:662},{x:1250,y:662},{x:1950,y:662},{x:2550,y:662},{x:3250,y:662}],ex:{x:3900,y:620}},
        3:{nm:'ENCRYPTED RAILS',w:4500,pl:[{x:0,y:680,w:500,g:1},{x:600,y:680,w:400,g:1},{x:1100,y:680,w:500,g:1},{x:1700,y:680,w:400,g:1},{x:2200,y:680,w:500,g:1},{x:2800,y:680,w:400,g:1},{x:3300,y:680,w:500,g:1},{x:3900,y:680,w:600,g:1},{x:250,y:540},{x:450,y:440},{x:750,y:500},{x:1300,y:540},{x:1550,y:440},{x:1900,y:500},{x:2400,y:540},{x:2650,y:440},{x:3000,y:500},{x:3500,y:540},{x:3750,y:440},{x:4100,y:500}],en:[{x:400,y:640,t:'d'},{x:800,y:460,t:'d'},{x:1400,y:640,t:'g'},{x:1700,y:460,t:'d'},{x:2500,y:640,t:'g'},{x:2800,y:460,t:'d'},{x:3600,y:640,t:'g'},{x:3900,y:460,t:'d'}],it:[{x:300,y:500,t:'cr'},{x:500,y:400,t:'cr'},{x:800,y:460,t:'hp'},{x:1350,y:500,t:'cr'},{x:1600,y:400,t:'cr'},{x:1950,y:460,t:'en'},{x:2450,y:500,t:'cr'},{x:2700,y:400,t:'cr'},{x:3050,y:460,t:'hp'},{x:3550,y:500,t:'cr'},{x:3800,y:400,t:'cr'},{x:4150,y:460,t:'cr'}],hz:[{x:550,y:662},{x:1050,y:662},{x:1650,y:662},{x:2150,y:662},{x:2750,y:662},{x:3250,y:662},{x:3850,y:662}],ex:{x:4400,y:620}},
        4:{nm:'FIREWALL',w:4000,pl:[{x:0,y:680,w:800,g:1},{x:900,y:680,w:600,g:1},{x:1600,y:680,w:500,g:1},{x:2200,y:680,w:600,g:1},{x:2900,y:680,w:500,g:1},{x:3500,y:680,w:500,g:1},{x:400,y:540},{x:250,y:410},{x:550,y:410},{x:1100,y:510},{x:1350,y:400},{x:1800,y:540},{x:2050,y:410},{x:2450,y:510},{x:2700,y:390},{x:3100,y:510},{x:3650,y:400}],en:[{x:350,y:640,t:'g'},{x:500,y:500,t:'d'},{x:300,y:370,t:'d'},{x:600,y:370,t:'d'},{x:1200,y:640,t:'g'},{x:1450,y:360,t:'d'},{x:1900,y:640,t:'g'},{x:2150,y:370,t:'d'},{x:2550,y:640,t:'g'},{x:2800,y:350,t:'d'},{x:3200,y:640,t:'g'},{x:3750,y:360,t:'d'}],it:[{x:450,y:500,t:'cr'},{x:300,y:370,t:'hp'},{x:600,y:370,t:'en'},{x:1150,y:470,t:'cr'},{x:1400,y:360,t:'cr'},{x:1850,y:500,t:'hp'},{x:2100,y:370,t:'cr'},{x:2500,y:470,t:'cr'},{x:2750,y:350,t:'en'},{x:3150,y:470,t:'hp'},{x:3700,y:360,t:'cr'}],hz:[{x:850,y:662},{x:1550,y:662},{x:2150,y:662},{x:2850,y:662},{x:3450,y:662}],ex:{x:3900,y:620}},
        5:{nm:'LIBERATION',w:5000,pl:[{x:0,y:680,w:650,g:1},{x:750,y:680,w:400,g:1},{x:1250,y:680,w:500,g:1},{x:1850,y:680,w:400,g:1},{x:2350,y:680,w:500,g:1},{x:2950,y:680,w:400,g:1},{x:3450,y:680,w:500,g:1},{x:4050,y:680,w:400,g:1},{x:4550,y:680,w:450,g:1},{x:350,y:540},{x:550,y:420},{x:950,y:500},{x:1450,y:540},{x:1680,y:420},{x:2050,y:500},{x:2550,y:540},{x:2780,y:420},{x:3150,y:500},{x:3650,y:540},{x:3880,y:420},{x:4250,y:500},{x:4700,y:400}],en:[{x:450,y:640,t:'g'},{x:600,y:380,t:'d'},{x:1050,y:460,t:'d'},{x:1550,y:640,t:'g'},{x:1780,y:380,t:'d'},{x:2150,y:460,t:'d'},{x:2650,y:640,t:'g'},{x:2880,y:380,t:'d'},{x:3250,y:460,t:'d'},{x:3750,y:640,t:'g'},{x:3980,y:380,t:'d'},{x:4350,y:460,t:'d'},{x:4800,y:360,t:'d'}],it:[{x:400,y:500,t:'cr'},{x:600,y:380,t:'cr'},{x:1000,y:460,t:'hp'},{x:1500,y:500,t:'cr'},{x:1730,y:380,t:'cr'},{x:2100,y:460,t:'en'},{x:2600,y:500,t:'cr'},{x:2830,y:380,t:'cr'},{x:3200,y:460,t:'hp'},{x:3700,y:500,t:'cr'},{x:3930,y:380,t:'cr'},{x:4300,y:460,t:'en'},{x:4750,y:360,t:'cr'}],hz:[{x:700,y:662},{x:1200,y:662},{x:1800,y:662},{x:2300,y:662},{x:2900,y:662},{x:3400,y:662},{x:4000,y:662},{x:4500,y:662}],ex:{x:4900,y:620}}
    };return L[this.lv]||L[1]},
update:function(t){
    if(this.dead||this.won)return;
    var sp=260,bs=400,og=this.player.body.onFloor();
    if(this.keys.a.isDown){this.player.setVelocityX(-sp);this.player.setFlipX(true)}else if(this.keys.d.isDown){this.player.setVelocityX(sp);this.player.setFlipX(false)}else this.player.setVelocityX(this.player.body.velocity.x*0.85);
    if(this.keys.sp.isDown&&this.en>0){this.player.setVelocityY(-bs);this.en-=0.6;this.player.setTexture('pf')}else{this.player.setTexture('p');if(og)this.en=Math.min(100,this.en+0.35)}
    var self=this;
    this.enemies.getChildren().forEach(function(e){if(!e.active)return;var pd=e.tp==='d'?150:100;e.x+=e.dir*(e.tp==='d'?1.8:1);if(e.x>e.sx+pd||e.x<e.sx-pd){e.dir*=-1;e.setFlipX(e.dir<0)}if(e.tp==='g'&&Phaser.Math.Distance.Between(e.x,e.y,self.player.x,self.player.y)<320&&t>e.st){self.enemyShoot(e);e.st=t+1800}});
    this.bullets.getChildren().forEach(function(b){if(b.x<0||b.x>5500)b.destroy()});
    this.ebullets.getChildren().forEach(function(b){if(b.x<0||b.x>5500)b.destroy()});
    this.updateHUD();
},
shoot:function(pt){if(this.time.now-this.lastShot<170)return;this.lastShot=this.time.now;Audio.fx(700);var b=this.bullets.create(this.player.x,this.player.y-5,'b');b.body.allowGravity=false;var wp=this.cameras.main.getWorldPoint(pt.x,pt.y),a=Phaser.Math.Angle.Between(this.player.x,this.player.y,wp.x,wp.y);b.setRotation(a);this.physics.velocityFromRotation(a,600,b.body.velocity)},
enemyShoot:function(e){var b=this.ebullets.create(e.x,e.y,'eb');b.body.allowGravity=false;var a=Phaser.Math.Angle.Between(e.x,e.y,this.player.x,this.player.y);this.physics.velocityFromRotation(a,280,b.body.velocity)},
hitEnemy:function(b,e){b.destroy();e.hp-=25;Audio.fx(200);if(e.hp<=0){e.destroy();this.sc+=e.tp==='d'?120:250}},
playerHit:function(p,e){if(this.player.inv)return;this.takeDamage(e.tp==='d'?15:25)},
playerHitHaz:function(){if(this.player.inv)return;this.takeDamage(35)},
playerHitBullet:function(p,b){b.destroy();if(this.player.inv)return;this.takeDamage(18)},
takeDamage:function(dm){var self=this;this.hp-=dm;Audio.fx(150);this.cameras.main.shake(80,0.008);if(this.hp<=0){this.gameOver();return}this.player.inv=true;this.tweens.add({targets:this.player,alpha:0.4,duration:70,yoyo:true,repeat:5,onComplete:function(){self.player.inv=false;self.player.alpha=1}})},
collect:function(p,i){var t=i.tp;i.destroy();Audio.fx(900);if(t==='cr'){this.cry++;this.sc+=80}else if(t==='hp')this.hp=Math.min(100,this.hp+30);else if(t==='en')this.en=Math.min(100,this.en+40)},
updateHUD:function(){this.hpBar.clear();this.hpBar.fillStyle(RD);this.hpBar.fillRoundedRect(48,14,Math.max(0,130*(this.hp/100)),10,3);this.enBar.clear();this.enBar.fillStyle(PK);this.enBar.fillRoundedRect(48,36,Math.max(0,130*(this.en/100)),10,3);this.scTxt.setText(String(this.sc));this.crTxt.setText(String(this.cry))},
win:function(){if(this.won)return;this.won=true;var self=this;this.physics.pause();Audio.stop();Audio.fx(523);setTimeout(function(){Audio.fx(659)},150);setTimeout(function(){Audio.fx(784)},300);setTimeout(function(){Audio.fx(1047)},450);this.cameras.main.flash(400,0,255,136);if(U&&T)fetch('/api/game/score',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+T},body:JSON.stringify({level:this.lv,score:this.sc,crypto:this.cry})});this.add.rectangle(W/2,H/2,W,H,0x000000,0.9).setScrollFactor(0).setDepth(200);this.add.text(W/2,H/2-60,'LEVEL COMPLETE',{fontSize:'32px',color:'#00ff88'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);this.add.text(W/2,H/2-10,'Score: '+this.sc+' | Crypto: '+this.cry,{fontSize:'14px',color:'#aaa'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);if(this.lv<5)this.btn(W/2,H/2+60,'NEXT LEVEL',function(){Audio.play();self.scene.restart({lv:self.lv+1})});this.btn(W/2,H/2+(this.lv<5?120:60),'MENU',function(){self.scene.start('Levels')})},
gameOver:function(){this.dead=true;var self=this;this.physics.pause();Audio.stop();this.cameras.main.shake(250,0.015);this.add.rectangle(W/2,H/2,W,H,0x000000,0.9).setScrollFactor(0).setDepth(200);this.add.text(W/2,H/2-40,'SYSTEM FAILURE',{fontSize:'32px',color:'#ff4466'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);this.add.text(W/2,H/2+10,'Score: '+this.sc,{fontSize:'16px',color:'#D0A0B7'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);this.btn(W/2,H/2+70,'RETRY',function(){Audio.play();self.scene.restart({lv:self.lv})});this.btn(W/2,H/2+130,'MENU',function(){self.scene.start('Levels')})},
btn:function(x,y,t,f){var b=this.add.image(x,y,'bt').setInteractive({useHandCursor:true}).setScrollFactor(0).setDepth(200),tx=this.add.text(x,y,t,{fontSize:'13px',color:'#D0A0B7'}).setOrigin(0.5).setScrollFactor(0).setDepth(200);b.on('pointerover',function(){b.setTexture('bt2');tx.setColor('#0d0d15')});b.on('pointerout',function(){b.setTexture('bt');tx.setColor('#D0A0B7')});b.on('pointerdown',f)}
});

var PauseScene=new Phaser.Class({Extends:Phaser.Scene,
initialize:function(){Phaser.Scene.call(this,{key:'Pause'})},
init:function(d){this.lv=d.lv},
create:function(){var self=this;this.add.rectangle(W/2,H/2,W,H,0x000000,0.85);this.add.text(W/2,H/2-80,'PAUSED',{fontSize:'32px',color:'#D0A0B7'}).setOrigin(0.5);this.btn(W/2,H/2-10,'RESUME',function(){self.scene.stop();self.scene.resume('Game')});this.btn(W/2,H/2+50,'RESTART',function(){self.scene.stop();self.scene.stop('Game');self.scene.start('Game',{lv:self.lv})});this.btn(W/2,H/2+110,'QUIT',function(){Audio.stop();self.scene.stop();self.scene.stop('Game');self.scene.start('Levels')})},
btn:function(x,y,t,f){var b=this.add.image(x,y,'bt').setInteractive({useHandCursor:true}),tx=this.add.text(x,y,t,{fontSize:'13px',color:'#D0A0B7'}).setOrigin(0.5);b.on('pointerover',function(){b.setTexture('bt2');tx.setColor('#0d0d15')});b.on('pointerout',function(){b.setTexture('bt');tx.setColor('#D0A0B7')});b.on('pointerdown',f)}
});

new Phaser.Game({type:Phaser.AUTO,width:W,height:H,parent:'g',backgroundColor:'#0d0d15',physics:{default:'arcade',arcade:{gravity:{y:850},debug:false}},scene:[BootScene,MenuScene,LevelsScene,LeaderScene,GameScene,PauseScene]});
</script></body></html>
